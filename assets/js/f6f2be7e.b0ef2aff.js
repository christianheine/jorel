"use strict";(self.webpackChunkjorel_docs=self.webpackChunkjorel_docs||[]).push([[516],{513:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"basic-usage/cancellation","title":"Cancellation Support","description":"JorEl supports cancelling ongoing LLM generations using the standard AbortSignal API. This is useful for implementing timeouts, user-initiated cancellations, or cleaning up when operations are no longer needed.","source":"@site/docs/basic-usage/cancellation.md","sourceDirName":"basic-usage","slug":"/basic-usage/cancellation","permalink":"/jorel/docs/basic-usage/cancellation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"learn","previous":{"title":"Token Tracking","permalink":"/jorel/docs/basic-usage/token-tracking"},"next":{"title":"Advanced Configuration","permalink":"/jorel/docs/basic-usage/advanced-configuration"}}');var o=t(4848),l=t(8453);const s={sidebar_position:8},a="Cancellation Support",i={},c=[{value:"Basic Cancellation",id:"basic-cancellation",level:2},{value:"Cancelling Streaming Responses",id:"cancelling-streaming-responses",level:2},{value:"Cancellation with Stream Buffering",id:"cancellation-with-stream-buffering",level:2},{value:"Timeout Pattern",id:"timeout-pattern",level:2},{value:"Cancellation with Tools",id:"cancellation-with-tools",level:2},{value:"Cancellation with Metadata",id:"cancellation-with-metadata",level:2},{value:"User-Initiated Cancellation",id:"user-initiated-cancellation",level:2},{value:"Provider Support",id:"provider-support",level:2},{value:"Important Notes",id:"important-notes",level:2},{value:"Implementing Cancellable Tools",id:"implementing-cancellable-tools",level:2},{value:"Examples",id:"examples",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"cancellation-support",children:"Cancellation Support"})}),"\n",(0,o.jsxs)(n.p,{children:["JorEl supports cancelling ongoing LLM generations using the standard ",(0,o.jsx)(n.code,{children:"AbortSignal"})," API. This is useful for implementing timeouts, user-initiated cancellations, or cleaning up when operations are no longer needed."]}),"\n",(0,o.jsx)(n.h2,{id:"basic-cancellation",children:"Basic Cancellation"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"AbortController"})," to create a cancellable request:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import { JorEl } from \'jorel\';\n\nconst jorEl = new JorEl({ openAI: true });\n\n// Create an abort controller\nconst controller = new AbortController();\n\n// Start the generation\nconst promise = jorEl.text(\n  "Write a long essay about the history of computing",\n  {\n    model: "gpt-4o-mini",\n    abortSignal: controller.signal\n  }\n);\n\n// Cancel after 5 seconds\nsetTimeout(() => {\n  console.log("Cancelling request...");\n  controller.abort();\n}, 5000);\n\ntry {\n  const response = await promise;\n  console.log(response);\n} catch (error) {\n  if (error.name === \'AbortError\') {\n    console.log("Request was cancelled");\n  } else {\n    throw error;\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"cancelling-streaming-responses",children:"Cancelling Streaming Responses"}),"\n",(0,o.jsx)(n.p,{children:"Cancellation works seamlessly with streaming:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'const controller = new AbortController();\n\nconst stream = jorEl.stream(\n  "Generate a very long story",\n  {\n    abortSignal: controller.signal\n  }\n);\n\n// Cancel after receiving some chunks\nlet chunkCount = 0;\ntry {\n  for await (const chunk of stream) {\n    process.stdout.write(chunk);\n    chunkCount++;\n    \n    if (chunkCount > 10) {\n      controller.abort();\n    }\n  }\n} catch (error) {\n  if (error.name === \'AbortError\') {\n    console.log("\\nStream cancelled after 10 chunks");\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"cancellation-with-stream-buffering",children:"Cancellation with Stream Buffering"}),"\n",(0,o.jsx)(n.p,{children:"When using stream buffering, cancellation will gracefully end the stream after flushing any buffered content:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'const controller = new AbortController();\n\nconst stream = jorEl.stream(\n  "Generate a story",\n  {\n    streamBuffer: { bufferTimeMs: 200 },\n    abortSignal: controller.signal\n  }\n);\n\n// Cancel after 2 seconds\nsetTimeout(() => controller.abort(), 2000);\n\ntry {\n  for await (const chunk of stream) {\n    process.stdout.write(chunk);\n  }\n} catch (error) {\n  console.log("\\nStream ended gracefully");\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"timeout-pattern",children:"Timeout Pattern"}),"\n",(0,o.jsx)(n.p,{children:"A common use case is implementing timeouts:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"async function generateWithTimeout(prompt: string, timeoutMs: number) {\n  const controller = new AbortController();\n  \n  // Set up timeout\n  const timeoutId = setTimeout(() => {\n    controller.abort();\n  }, timeoutMs);\n  \n  try {\n    const response = await jorEl.text(prompt, {\n      abortSignal: controller.signal\n    });\n    \n    clearTimeout(timeoutId);\n    return response;\n  } catch (error) {\n    clearTimeout(timeoutId);\n    \n    if (error.name === 'AbortError') {\n      throw new Error(`Request timed out after ${timeoutMs}ms`);\n    }\n    throw error;\n  }\n}\n\n// Use it\ntry {\n  const response = await generateWithTimeout(\n    \"Explain quantum computing\",\n    10000 // 10 second timeout\n  );\n  console.log(response);\n} catch (error) {\n  console.error(error.message);\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"cancellation-with-tools",children:"Cancellation with Tools"}),"\n",(0,o.jsx)(n.p,{children:"When using tools, cancellation will stop the generation and any pending tool executions:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import { z } from \'zod\';\n\nconst controller = new AbortController();\n\n// Tool that takes time to execute\nconst slowTool = {\n  name: "fetch_data",\n  description: "Fetch data from API",\n  executor: async ({ url }) => {\n    await new Promise(resolve => setTimeout(resolve, 5000));\n    return { data: "result" };\n  },\n  params: z.object({ url: z.string() })\n};\n\nconst promise = jorEl.text(\n  "Fetch data from https://api.example.com",\n  {\n    tools: [slowTool],\n    abortSignal: controller.signal\n  }\n);\n\n// Cancel before tool finishes\nsetTimeout(() => controller.abort(), 2000);\n\ntry {\n  await promise;\n} catch (error) {\n  console.log("Request cancelled before tool completed");\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"cancellation-with-metadata",children:"Cancellation with Metadata"}),"\n",(0,o.jsx)(n.p,{children:"You can check if a request was cancelled in the metadata:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'const controller = new AbortController();\n\nsetTimeout(() => controller.abort(), 1000);\n\nconst { response, stopReason } = await jorEl.text(\n  "Generate text",\n  { abortSignal: controller.signal },\n  true\n).catch(error => {\n  // If cancelled during generation\n  return { response: "", stopReason: "userCancelled" };\n});\n\nif (stopReason === "userCancelled") {\n  console.log("Generation was cancelled");\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"user-initiated-cancellation",children:"User-Initiated Cancellation"}),"\n",(0,o.jsx)(n.p,{children:"Here's a practical example with user interaction:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import readline from 'readline';\n\nasync function interactiveCancellation() {\n  const controller = new AbortController();\n  \n  const rl = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout\n  });\n  \n  // Listen for user pressing 'q' to cancel\n  process.stdin.on('keypress', (str, key) => {\n    if (str === 'q') {\n      console.log(\"\\nCancelling...\");\n      controller.abort();\n    }\n  });\n  \n  console.log(\"Generating response... (press 'q' to cancel)\\n\");\n  \n  const stream = jorEl.stream(\n    \"Write a detailed explanation of machine learning\",\n    { abortSignal: controller.signal }\n  );\n  \n  try {\n    for await (const chunk of stream) {\n      process.stdout.write(chunk);\n    }\n  } catch (error) {\n    console.log(\"\\n\\nCancelled by user\");\n  }\n  \n  rl.close();\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"provider-support",children:"Provider Support"}),"\n",(0,o.jsx)(n.p,{children:"Cancellation support varies by provider:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Provider"}),(0,o.jsx)(n.th,{children:"Non-Streaming"}),(0,o.jsx)(n.th,{children:"Streaming"}),(0,o.jsx)(n.th,{children:"Notes"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"OpenAI"})}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"Complete support"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Anthropic"})}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"Complete support"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Google Vertex AI"})}),(0,o.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,o.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,o.jsx)(n.td,{children:"May not cancel immediately"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Google Generative AI"})}),(0,o.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,o.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,o.jsx)(n.td,{children:"May not cancel immediately"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Groq"})}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"Complete support"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Grok"})}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"Complete support"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Mistral"})}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"\u2705 Full"}),(0,o.jsx)(n.td,{children:"Complete support"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Ollama"})}),(0,o.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,o.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,o.jsx)(n.td,{children:"Depends on local setup"})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Not all providers support immediate cancellation"})," - Some may complete the current operation before stopping"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Tool executors are not automatically cancelled"})," - You need to handle AbortSignal in your tool implementations if they perform long operations"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cancelled requests throw an AbortError"})," - Always handle this error type appropriately"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Buffered streams flush before cancelling"})," - This ensures you don't lose content that's already been generated"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Check stopReason in metadata"})," - When a request is cancelled,  ",(0,o.jsx)(n.code,{children:"stopReason"})," will be ",(0,o.jsx)(n.code,{children:'"userCancelled"'})]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"implementing-cancellable-tools",children:"Implementing Cancellable Tools"}),"\n",(0,o.jsx)(n.p,{children:"If your tools perform long operations, you should check the AbortSignal:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'const cancellableTool = {\n  name: "process_data",\n  description: "Process large dataset",\n  executor: async ({ data }, context, secureContext) => {\n    // Check if already cancelled\n    if (context.abortSignal?.aborted) {\n      throw new Error("Operation cancelled");\n    }\n    \n    // Perform work in chunks, checking signal periodically\n    for (let i = 0; i < 100; i++) {\n      if (context.abortSignal?.aborted) {\n        throw new Error("Operation cancelled");\n      }\n      \n      // Do some work\n      await processChunk(data, i);\n    }\n    \n    return { success: true };\n  },\n  params: z.object({ data: z.string() })\n};\n'})}),"\n",(0,o.jsx)(n.p,{children:"Note: Currently, you would need to pass the AbortSignal through the context parameter manually when calling JorEl methods with tools."}),"\n",(0,o.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,o.jsx)(n.p,{children:"You can find complete working examples in the repository:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"examples/standard-use/open-ai/text-cancellation.ts"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"examples/standard-use/open-ai/stream-cancellation.ts"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"examples/standard-use/open-ai/stream-cancellation-with-buffering.ts"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var r=t(6540);const o={},l=r.createContext(o);function s(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);